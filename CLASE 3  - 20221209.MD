# EJERCICIOS

```
;WITH TODO AS (
SELECT 
	NSRHEMPLEADOID,  
	H.CSTBRUBROID,
	CNUMEROPLANILLA,
	NMONTOAPLICAR,
	CDESCRIPCION,
	NTIPOMOVIMIENTO
FROM SRHRUBRO H
	INNER JOIN STBRUBRO B
		ON H.CSTBRUBROID = B.CSTBRUBROID
), INGRESOS AS (
	SELECT 
	ROW_NUMBER() OVER (PARTITION BY NSRHEMPLEADOID ORDER BY NMONTOAPLICAR) AS ID
	,* FROM TODO 
	WHERE NTIPOMOVIMIENTO = 0
), DEDUCCIONES AS (
	SELECT 
		ROW_NUMBER() OVER (PARTITION BY NSRHEMPLEADOID ORDER BY NMONTOAPLICAR) AS ID
		,* FROM TODO WHERE NTIPOMOVIMIENTO <> 0
)

SELECT 
	COALESCE(A.NSRHEMPLEADOID, B.NSRHEMPLEADOID),
	COALESCE(A.CNUMEROPLANILLA,B.CNUMEROPLANILLA),
	COALESCE(A.CDESCRIPCION,'-') AS DESC_PERCEPCION,
	COALESCE(A.NMONTOAPLICAR,0.0) AS MONTO_PERCEPCION,
	COALESCE(B.CDESCRIPCION,'-') AS DESC_DEDUCCION,
	COALESCE(B.NMONTOAPLICAR, 0.0) AS MONTO_DEDUCCION,

FROM INGRESOS A
FULL JOIN DEDUCCIONES B 
	ON 
	A.NSRHEMPLEADOID = B.NSRHEMPLEADOID
	AND A.ID = B.ID
WHERE 
	A.NSRHEMPLEADOID = 49 OR B.NSRHEMPLEADOID = 49

```